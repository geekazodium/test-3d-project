[gd_scene load_steps=11 format=3 uid="uid://dkbyhrm8sdsgm"]

[ext_resource type="Script" uid="uid://bouafuxoorwbn" path="res://player/player_character_body.gd" id="1_gphhd"]
[ext_resource type="PackedScene" uid="uid://bjji6fcd42ffv" path="res://player/parry_success_scene.tscn" id="2_a730x"]
[ext_resource type="Script" uid="uid://r6g38psoexaf" path="res://player/camera/camera_orbiter.gd" id="2_uvqt2"]
[ext_resource type="Script" uid="uid://cwpwpp1ucih3c" path="res://player/camera/min_safe_margin_camera.gd" id="3_gphhd"]
[ext_resource type="Script" uid="uid://0c5e6p8dg6t3" path="res://player/player_movement_direction.gd" id="4_nijgw"]
[ext_resource type="Script" uid="uid://boj2kam5yrm10" path="res://player/parry_vis_indicator.gd" id="5_lduaf"]

[sub_resource type="CylinderMesh" id="CylinderMesh_nijgw"]
lightmap_size_hint = Vector2i(33, 14)
top_radius = 0.7
bottom_radius = 1.2
height = 0.1
radial_segments = 10
rings = 2
cap_top = false
cap_bottom = false

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_6adnx"]
radius = 0.4
height = 1.7

[sub_resource type="CapsuleMesh" id="CapsuleMesh_6adnx"]
radius = 0.4
height = 1.7

[sub_resource type="SphereShape3D" id="SphereShape3D_rsugj"]
radius = 0.2

[node name="PlayerCharacterBody" type="CharacterBody3D" node_paths=PackedStringArray("movement_direction")]
collision_layer = 17
collision_mask = 2
script = ExtResource("1_gphhd")
parry_success_scene = ExtResource("2_a730x")
movement_direction = NodePath("MovementDirection")

[node name="ParryVisIndicator" type="MeshInstance3D" parent="." node_paths=PackedStringArray("parry_active")]
mesh = SubResource("CylinderMesh_nijgw")
script = ExtResource("5_lduaf")
parry_active = NodePath("../BlockActiveTimer")

[node name="CapsuleCollisionShape" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_6adnx")

[node name="PlaceholderInstance" type="MeshInstance3D" parent="."]
mesh = SubResource("CapsuleMesh_6adnx")

[node name="ActionableTimer" type="Timer" parent="."]
process_callback = 0
one_shot = true

[node name="MovementDirection" type="Node" parent="." node_paths=PackedStringArray("input_yaw_src", "actionable_timer")]
process_physics_priority = -1
script = ExtResource("4_nijgw")
input_yaw_src = NodePath("CameraOrbiter")
actionable_timer = NodePath("../ActionableTimer")

[node name="CameraOrbiter" type="Node3D" parent="MovementDirection" node_paths=PackedStringArray("position_src")]
physics_interpolation_mode = 2
script = ExtResource("2_uvqt2")
min_pitch = -1.3089969389957472
max_pitch = 0.3490658503988659
position_src = NodePath("../..")

[node name="Camera3D" type="Camera3D" parent="MovementDirection/CameraOrbiter" node_paths=PackedStringArray("shapecast")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 8.5)
script = ExtResource("3_gphhd")
shapecast = NodePath("../ShapeCast3D")

[node name="ShapeCast3D" type="ShapeCast3D" parent="MovementDirection/CameraOrbiter"]
enabled = false
shape = SubResource("SphereShape3D_rsugj")
target_position = Vector3(0, 0, 8.5)
max_results = 1
collision_mask = 2

[node name="BlockCdTimer" type="Timer" parent="."]
process_callback = 0
wait_time = 0.5
one_shot = true

[node name="BlockActiveTimer" type="Timer" parent="."]
process_callback = 0
wait_time = 0.15
one_shot = true
